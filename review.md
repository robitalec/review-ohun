## Package Review

*Please check off boxes as applicable, and elaborate in comments below. Your review is not limited to these topics, as described in the reviewer guide*

-   **Briefly describe any working relationship you have (had) with the package authors.**
-   [x] As the reviewer I confirm that there are no [conflicts of interest](https://devguide.ropensci.org/policies.html#coi) for me to review this work (if you are unsure whether you are in conflict, please speak to your editor *before* starting your review).


#### Documentation

The package includes all the following forms of documentation:

-   [x] **A statement of need:** clearly stating problems the software is designed to solve and its target audience in README
-   [x] **Installation instructions:** for the development version of package and any non-standard dependencies in README
-   [x] **Vignette(s):** demonstrating major functionality that runs successfully locally
-   [x] **Function Documentation:** for all exported functions
-   [ ] **Examples:** (that run successfully locally) for all exported functions
-   [ ] **Community guidelines:** including contribution guidelines in the README or CONTRIBUTING, and DESCRIPTION with `URL`, `BugReports` and `Maintainer` (which may be autogenerated via `Authors@R`).

#### Functionality

-   [x] **Installation:** Installation succeeds as documented.
-   [ ] **Functionality:** Any functional claims of the software been confirmed.
-   [ ] **Performance:** Any performance claims of the software been confirmed.
-   [ ] **Automated tests:** Unit tests cover essential functions of the package and a reasonable range of inputs and conditions. All tests pass on the local machine.
-   [ ] **Packaging guidelines**: The package conforms to the rOpenSci packaging guidelines.

Estimated hours spent reviewing:

-   [x] Should the author(s) deem it appropriate, I agree to be acknowledged as a package reviewer ("rev" role) in the package DESCRIPTION file.

------------------------------------------------------------------------

### Review Comments

#### Documentation

**A statement of need**

Please consider adding a section to the README that 1) clarifies how `ohun` fits
into a broader workflow of working with sound event and 2) if any other packages
or approaches are available that share similar functionality to `ohun`. 

For 1), this could be adding few sentences describing what typical steps (and related 
packages) would come before and after using `ohun`. You could also add the 
workflow from the vignette to the README in this section. Consider a new user 
looking at the [Reference](https://marce10.github.io/ohun/reference/index.html) 
page on the website or the list of available functions in `ohun`... how do they
fit together?

```r
library(ohun)
#> Loading required package: tuneR
#> Loading required package: warbleR
#> Loading required package: seewave
#> Loading required package: NatureSounds
#> Loading required package: knitr
lsf.str('package:ohun')
#> consensus_detection : function (detection, by = "overlap", filter = "max", cores = 1, pb = TRUE)  
#> diagnose_detection : function (reference, detection, by.sound.file = FALSE, time.diagnostics = FALSE, 
#>     cores = 1, pb = TRUE, path = NULL, by = NULL, macro.average = FALSE, 
#>     min.overlap = 0.5)  
#> energy_detector : function (files = NULL, envelopes = NULL, path = ".", hop.size = 11.6, 
#>     wl = NULL, thinning = 1, bp = NULL, smooth = 5, threshold = 5, peak.amplitude = 0, 
#>     hold.time = 0, min.duration = 0, max.duration = Inf, cores = 1, pb = TRUE)  
#> feature_acoustic_data : function (path = ".", digits = 2)  
#> feature_reference : function (reference, path = NULL, by.sound.file = FALSE, units = c("ms", 
#>     "kHz"), digits = 2)  
#> filter_detection : function (detection, by = "overlap", filter = "max", cores = 1, pb = TRUE)  
#> get_envelopes : function (path = ".", files = NULL, bp = NULL, hop.size = 11.6, wl = NULL, 
#>     cores = 1, thinning = 1, pb = TRUE, smooth = 5, normalize = TRUE)  
#> get_templates : function (reference, acoustic.space = NULL, path = ".", n.sub.spaces = 1, 
#>     plot = TRUE, color = "#21908C4D", ...)  
#> label_detection : function (reference, detection, cores = 1, pb = TRUE, min.overlap = 0.5)  
#> label_spectro : function (wave, reference = NULL, detection = NULL, envelope = FALSE, threshold = NULL, 
#>     smooth = 5, collevels = seq(-100, 0, 5), palette = viridis::viridis, 
#>     template.correlation = NULL, line.x.position = 2, hop.size = NULL, 
#>     ...)  
#> merge_overlaps : function (X, pb = TRUE, cores = 1)  
#> optimize_energy_detector : function (reference, files = NULL, threshold = 5, peak.amplitude = 0, hop.size = 11.6, 
#>     wl = NULL, smooth = 5, hold.time = 0, min.duration = NULL, max.duration = NULL, 
#>     thinning = 1, cores = 1, pb = TRUE, by.sound.file = FALSE, bp = NULL, 
#>     path = ".", previous.output = NULL, envelopes = NULL, macro.average = FALSE, 
#>     min.overlap = 0.5)  
#> optimize_template_detector : function (template.correlations, reference, threshold, cores = 1, pb = TRUE, 
#>     by.sound.file = FALSE, previous.output = NULL, macro.average = FALSE, 
#>     min.overlap = 0.5)  
#> split_acoustic_data : function (path = ".", sgmt.dur = 10, sgmts = NULL, files = NULL, cores = 1, 
#>     pb = TRUE, only.sels = FALSE, X = NULL)  
#> summarize_diagnostic : function (diagnostic, time.diagnostics = FALSE, macro.average = FALSE)  
#> template_correlator : function (templates, files = NULL, hop.size = 11.6, wl = NULL, ovlp = 0, 
#>     wn = "hanning", cor.method = "pearson", cores = 1, path = ".", pb = TRUE, 
#>     type = "fourier", fbtype = "mel", ...)  
#> template_detector : function (template.correlations, cores = 1, threshold, pb = TRUE, verbose = TRUE)
```

For 2), as @sammlapp mentions, it's really helpful for a user to be aware of
what the options are and how they differ. The README for the `gt` package has a
good example of this here:
https://github.com/rstudio/gt#how-gt-fits-in-with-other-packages-that-generate-display-tables


**Installation instructions**

The dependency `seewave` brings system dependencies that might not be
immediately obvious to a new user of `ohun`. It might be helpful to include a
link to `seewave`'s installing and troubleshooting system requirements page, for
example: https://rug.mnhn.fr/seewave/inst.html


**Vignette(s)** 

It might be worth splitting this vignette into multiple vignettes. At its
current length, I find it a bit hard to digest all the moving pieces and
options. I personally find it easier to learn and use R packages if there are
many, shorter vignettes that describe the different major functions or steps
offered. You could have maybe four vignettes: introduction, energy based
detection, template based detection, and diagnosing/improving. The introductory
could expand on how `ohun` integrates with other R packages in this field, and
provide the background given in sections "Automatic sound event detection" and
"Signal detection theory applied to bioacoustics". Then the following vignettes
using the sections already written from the current vignette. This might just be
my opinion - so if you feel like it is better for `ohun` users to have
everything in one place, let me know.

Throughout the vignette, the warnings and messages were not shown using the
chunk options warnings=FALSE and messages=FALSE. I would recommend leaving all
messages and warnings in the rendered vignette, because a user may be surprised
and confused to see them appear locally, when they are not shown in the
vignette.


**Function Documentation** 



**Examples**

- Found errors locally using `devtools::run_examples()`


If recommendation to move `tuneR` to , the following issues can be resolved

In `feature_acoustic_data.R`:

- `could not find function "writeWave"` fixed by adding `library(tuneR)`



**Community guidelines**

Please consider also including the link to the repository
(https://github.com/maRce10/ohun) in the URL field in the DESCRIPTION as it
should have the most consistently up to date information for the package, for
example in the case that the website is not updated.


#### Functionality

**Installation**

**Functionality**

**Performance**

**Automated tests**

**Packaging guidelines**

Looks good: package name, snake_case, object_verb function naming, citation, and
code metadata. Consider using this following options for 
[keeping the code metadata up to date](https://github.com/ropensci/codemetar#keep-codemetajson-up-to-date) and
for [keeping the CITATION file up to date](https://docs.ropensci.org/cffr/reference/cff_gha_update.html).

Code style improved with a [recent
commit](https://github.com/maRce10/ohun/commit/6a32910cd5a794e274dc96ca44a1ca486434e075)
using the `styler` package. Before that, logical statements with `if` `else`
were not easy to read.

It is not clear whether or not functions in `ohun` are pipeable (see the second
point
[here](https://devguide.ropensci.org/building.html#function-and-argument-naming)).
If you think that is a relevant option, consider including an example in the
vignette that shows this.

As mentioned above, the README could use more information about how `ohun` fits
into the broader ecosystem, comparing `ohun` to other packages that provide
related functionality and details on the system requirements for `seewave`. The
README is also missing a brief demonstration of functionality (see the sixth
point [here](https://devguide.ropensci.org/building.html#readme)). The long form
examples in the vignettes are useful for a user that is already intending to use
`ohun` but shorter examples in the README help new users understand what `ohun`
is offering.

Documentation looks good with all functions having accompanying examples,
detailed return values and references included in the vignette. There is good
use of `@seealso` to link users to related functions in `ohun`. Only one URL
needed editing (according to `urlchecker`), see below.

You could consider using `vdiffr` for testing plots. Currently the tests for
functions that produce plots are just testing that they return NULL. This isn't
a very useful test, and while testing plots is not straightforward or intuitive,
you could see if `vdiffr` helps! More detailed comments on testing below.

Detailed comments on package dependencies below.

#### Additional comments

The following sections have further details from above, and sometimes an 
accompanying pull request. I found it easier to work through the review by
looking at the source code locally, and making changes as I noticed things. 
I also felt like it would be easier to highlight specific lines of code
by just editing them, instead of referring to eg. Lines 83-85 in some file. 
No pressure to accept any of these pull requests directly, and I hope that you
find it a clear and useful approach. 


##### Repository

The repository size is ~ 120 mb. 

I recommend that you delete, at least, the following files:

- .Rproj.user/
- .Rhistory
- ..Rcheck/
- ..pdf
- .Rdata
- testing/
- docs/ (in this case since you are using the pkgdown workflow with the gh-pages branch)

Some of these files were presumably added before they were listed in the 
`.gitignore` file. I have deleted them in the following pull request:

https://github.com/maRce10/ohun/pull/12



##### README

The badge for `R-CMD-check` seems to point to an old workflow. The current
workflow (`tic`) shows failing tests, whereas the `R-CMD-check` shows passing 
test. I would recommend removing this old badge if it is no longer relevant. 

A couple minor edits to the README are in the following pull request:

https://github.com/maRce10/ohun/pull/13



##### NEWS

It might be helpful to users if the items in NEWS were accompanied with
references to the relevant pull requests and issues (eg. #5). For example:
https://github.com/tidyverse/ggplot2/blob/main/NEWS.md

##### Vignette

As mentioned above, consider splitting the single vignette into 
multiple vignettes:

- Get started vignette
    - Background and theory
    - How does ohun fit in
    - What other packages does ohun interface with
    - Overview of functions provided by ohun
- Energy based detection
- Template based detection
- FAQ / best practices / advice / tips

Minor proposed edits to the vignette are in the following pull request:

https://github.com/maRce10/ohun/pull/14



##### Contributing

The CONTRIBUTING.md document looks like it's based on the template from
https://contributing.md/. Because of this, there were some places that 
links to sections didn't work, and it often still referred to the CONTRIBUTING.md 
version. 

There isn't a code of conduct in the repository to link to, so I removed that 
dead link. But please consider including one (see the rOpenSci pages for more
details: [Contributing Guide](https://devguide.ropensci.org/contributingguide.html), 
[Code of Conduct](https://ropensci.org/code-of-conduct/)). 

Relevant pull request:

https://github.com/maRce10/ohun/pull/15

##### Documentation

I propose removing the "last modification date" from the R/ files
since this information is redundant and more error prone than the information
provided by Git. 


